

<style>
  /* Figma Design System Tokens */
  :root {
    /* Light theme colors */
    --figma-color-bg: #ffffff;
    --figma-color-bg-secondary: #f5f5f5;
    --figma-color-bg-tertiary: #f0f0f0;
    --figma-color-bg-brand: #18a0fb;
    --figma-color-bg-brand-hover: #0d8ce0;
    --figma-color-bg-brand-pressed: #0b7bc7;
    --figma-color-bg-danger: #ff3b30;
    --figma-color-bg-danger-hover: #e6352b;
    --figma-color-bg-danger-pressed: #cc2e26;
    --figma-color-bg-success: #34c759;
    --figma-color-bg-warning: #ff9500;

    /* Light theme text colors */
    --figma-color-text: #000000;
    --figma-color-text-secondary: #333333;
    --figma-color-text-tertiary: #666666;
    --figma-color-text-disabled: #999999;
    --figma-color-text-brand: #18a0fb;
    --figma-color-text-danger: #ff3b30;
    --figma-color-text-success: #34c759;

    /* Light theme border colors */
    --figma-color-border: #e5e5e5;
    --figma-color-border-strong: #cccccc;
    --figma-color-border-focus: #18a0fb;
    --figma-color-border-danger: #ff3b30;

    /* Light theme shadow */
    --figma-shadow-small: 0px 1px 2px rgba(0, 0, 0, 0.05);
    --figma-shadow-medium: 0px 2px 4px rgba(0, 0, 0, 0.1);
    --figma-shadow-large: 0px 4px 8px rgba(0, 0, 0, 0.15);

    /* Typography */
    --figma-font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    --figma-font-size-xs: 11px;
    --figma-font-size-sm: 12px;
    --figma-font-size-md: 14px;
    --figma-font-size-lg: 16px;
    --figma-font-size-xl: 18px;

    /* Spacing */
    --figma-space-xs: 4px;
    --figma-space-sm: 8px;
    --figma-space-md: 12px;
    --figma-space-lg: 16px;
    --figma-space-xl: 24px;
    --figma-space-xxl: 32px;

    /* Border radius */
    --figma-radius-sm: 2px;
    --figma-radius-md: 4px;
    --figma-radius-lg: 6px;
    --figma-radius-xl: 8px;
  }

  /* Dark theme overrides */
  [data-theme="dark"] {
    --figma-color-bg: #2c2c2c;
    --figma-color-bg-secondary: #383838;
    --figma-color-bg-tertiary: #484848;
    --figma-color-bg-brand: #18a0fb;
    --figma-color-bg-brand-hover: #0d8ce0;
    --figma-color-bg-brand-pressed: #0b7bc7;
    --figma-color-bg-danger: #ff453a;
    --figma-color-bg-danger-hover: #ff375f;
    --figma-color-bg-danger-pressed: #ff2d55;
    --figma-color-bg-success: #30d158;
    --figma-color-bg-warning: #ff9f0a;

    --figma-color-text: #ffffff;
    --figma-color-text-secondary: #e5e5e5;
    --figma-color-text-tertiary: #b3b3b3;
    --figma-color-text-disabled: #666666;
    --figma-color-text-brand: #18a0fb;
    --figma-color-text-danger: #00ffff;
    --figma-color-text-success: #30d158;

    --figma-color-border: #484848;
    --figma-color-border-strong: #666666;
    --figma-color-border-focus: #18a0fb;
    --figma-color-border-danger: #00ffff;

    --figma-shadow-small: 0px 1px 2px rgba(0, 0, 0, 0.3);
    --figma-shadow-medium: 0px 2px 4px rgba(0, 0, 0, 0.4);
    --figma-shadow-large: 0px 4px 8px rgba(0, 0, 0, 0.5);
  }

  body {
    background-color: var(--figma-color-bg);
    font-family: var(--figma-font-family);
    margin: 0;
    padding: 0;
    color: var(--figma-color-text);
    transition: background-color 0.2s ease, color 0.2s ease;
  }

  /* Main div with elements */
  .main-div {
    align-content: center;
    text-align: center; 
    margin-top: 2%;
  }



  .slider-input {
    -webkit-appearance: none;
    width: 80%;
    height: 4px;
    border-radius: var(--figma-radius-sm);  
    padding: 0.2rem;
    margin: 0.5rem;
    background: var(--figma-color-border-strong);
    outline: none;
    opacity: 0.6;
    -webkit-transition: .2s;
    transition: opacity .2s;
  }

  .slider-input::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 13px;
    height: 13px;
    border-radius: 50%; 
    background: var(--figma-color-bg-brand);
    cursor: pointer;
    opacity: 1;
  }

  .slider-label {
    font-family: var(--figma-font-family); 
    color: var(--figma-color-text-brand); 
    font-size: var(--figma-font-size-md); 
    text-align: center; 
    /* margin-top: var(--figma-space-sm);  */
    font-weight: 500;
  }

  /* Colors selection section */
  .select-colors {
    background-color: var(--figma-color-bg); 
    padding: 0.2rem;
    margin: 0.5rem;
    border: 1px solid var(--figma-color-border);
    border-radius: var(--figma-radius-lg);
    box-shadow: var(--figma-shadow-small); 
  }

  /* Confetti type label */
  .confetti-type-label {
    font-size: var(--figma-font-size-sm);
    text-align: center;
    font-weight: 500;
    color: var(--figma-color-text-secondary);
    /* margin: var(--figma-space-md); */
  }

  /* Checkbox styling */
  .checkboxes {
    width: 100%;
    text-align: center;
    padding-left: 5%;
    margin: 0%;
    padding-top: var(--figma-space-sm);
    display: flex;
    flex-wrap: wrap ;
    /* flex-direction: column; */
    /* align-items: center;
    justify-content: center; */
    gap: 0.5rem;
  }

  .checkbox-div {
    /* background-color: var(--figma-color-bg-secondary); */
    width: 40%;
    /* height: 4.5%; */
    display: inline-block;
    margin-top:0.2rem;
    margin-bottom: 0.2rem;
    padding-right: 0%;
    /* padding-left: 0.2rem; */
    text-align: left;
    vertical-align: middle;
  }

  .blank-div-in-checkboxes {
    display: inline-block;
    width: 0.5rem;
  }

  .checkbox {
    /* margin: 1% 0;
    margin-right: 3%; */
    vertical-align: middle;
    cursor: pointer;
  }

  .checkbox-label {
    font-family: var(--figma-font-family);
    font-size: var(--figma-font-size-xs);
    /* font-weight: 400; */
    margin-left: 0.3rem;
    color: var(--figma-color-text-tertiary);
    vertical-align: middle;
    cursor: pointer;
  }

  /* Color selection */
  .input-colors-section {
    display: block;
    text-align: center;
    width: 100%;
    margin: 0;
    padding: 0;
  }

  .color-picker-div {
    /* display: block; */
    text-align: center;

    /* padding-bottom: var(--figma-space-sm); */
    /* width: auto; */
  }



  input[type=color] {
    width: 45%;
    height: 5%;
    border: none;
    border-radius: var(--figma-radius-sm);
    background: none;
    margin: 2% 2%;
    padding: 0;
    vertical-align: middle;
    cursor: pointer;
  }

  input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
  }

  input[type="color"]::-webkit-color-swatch {
    border: solid 1px var(--figma-color-border);
    border-radius: var(--figma-radius-sm);
  }

  .hex-input {
    /* display: inline-block; */
    width: 44%;
    /* font-weight: 500; */
    color: var(--figma-color-text-secondary);
    height: 1.5rem;
    /* vertical-align: middle; */
    font-size: var(--figma-font-size-xs);
    text-transform: uppercase;
    border: 1px solid var(--figma-color-border-strong);
    text-align: center;
    border-radius: var(--figma-radius-md);
    margin: 2% 2%;
    background-color: var(--figma-color-bg);
    transition: all 0.2s ease;
  }

  .hex-input:focus {
    border-color: var(--figma-color-border-focus);
    outline: none;
  }

  #color{
    height: 1.5rem;

    border-radius: var(--figma-radius-md);
  }

  /* Display color area */
  .display-color-div {
    display: block;
    border: 1px solid var(--figma-color-border);
    background-color: #ededed !important;
    border-radius: var(--figma-radius-lg);
    margin: 3.5% 2%;
    padding: 1% 2%;
    width: auto;
    height: 4rem;
    overflow: auto;
    scroll-behavior: smooth;
    text-align: center;
  }

  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 2px;
  }

  ::-webkit-scrollbar-track {
    background: var(--figma-color-bg-tertiary); 
  }

  ::-webkit-scrollbar-thumb {
    background: var(--figma-color-border-strong); 
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--figma-color-text-tertiary); 
  }

  .display-color-text1 {
    display: inline-block;
    color: #222;
    font-weight: 400;
    font-size: var(--figma-font-size-xs);
    margin: 0;
    padding-top: 1%;
    padding-bottom: 8%;
    padding-left: 5%;
    padding-right: 5%;
    text-align: center;
    vertical-align: top;
  }

  .display-color-text2 {
    display: inline-block;
    color: var(--figma-color-text-disabled);
    font-weight: 400;
    font-size: var(--figma-font-size-xs);
    margin: 0;
    padding-top: 1%;
    padding-bottom: 8%;
    padding-left: 5%;
    padding-right: 5%;
    text-align: center;
    vertical-align: top;
  }

  a:link, a:active {
    text-decoration: none;
    color: var(--figma-color-text-tertiary);
  }

 

  /* small button styling */
  .small-button {
    font-size: var(--figma-font-size-xs);
    margin: 2% 2%;
    padding: var(--figma-space-xs) var(--figma-space-sm);
    width: 44%;
    display: inline;
    border: 1px solid var(--figma-color-bg-brand);
    background-color: var(--figma-color-bg);
    border-radius: var(--figma-radius-md);
    color: var(--figma-color-bg-brand);
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: var(--figma-font-family);
  }

  .small-button:hover {
    background-color: var(--figma-color-bg-brand-hover);
    border: 1px solid var(--figma-color-bg-brand-hover);
    color: #fff;
    transition-duration: 0.2s;
  }

  .small-button:active {
    background-color: var(--figma-color-bg-brand-pressed);
    border: 1px solid var(--figma-color-bg-brand-pressed);
    color: #fff;
    transition-duration: 0.2s;
  }

  /* large button styling */
  .large-button {
    font-size: var(--figma-font-size-sm);
    margin: 0.2rem 0;
    padding: var(--figma-space-sm) var(--figma-space-sm);
    width: 12.8rem;
    /* display: inline; */
    border: 1px solid var(--figma-color-bg-brand);
    background-color: var(--figma-color-bg-brand);
    border-radius: var(--figma-radius-md);
    color: #fff;
    cursor: pointer;
    box-shadow: var(--figma-shadow-small);
    transition: all 0.2s ease;
    font-family: var(--figma-font-family);
  }

  .large-button:hover {
    background-color: var(--figma-color-bg-brand-hover);
    border: 1px solid var(--figma-color-bg-brand-hover);
    color: #fff;
    transition-duration: 0.2s;
  }

  .large-button:active {
    background-color: var(--figma-color-bg-brand-pressed);
    border: 1px solid var(--figma-color-bg-brand-pressed);
    color: #fff;
    transition-duration: 0.2s;
  }

  /* Footer styling */
  .bottomContainer {
    background: var(--figma-color-bg-secondary);
    bottom: 0;
    position: fixed;
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--figma-space-sm);
    border-top: 1px solid var(--figma-color-border);
    left: 0;
  }
  .leftFooter, .rightFooter {
    flex: initial;
    display: flex;
    align-items: center;
  }
  .credit {
    font-family: var(--figma-font-family);
    font-size: var(--figma-font-size-sm);
    color: var(--figma-color-text-tertiary);
    margin: 0;
    text-align: right;
    padding-right: 16px;
  }

  /* Theme toggle styling */
  .theme-toggle-container {
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    align-items: center;
    padding: 0 var(--figma-space-sm);
    width: auto;
  }

  .theme-toggle {
    padding: var(--figma-space-xs) var(--figma-space-sm);
    font-size: var(--figma-font-size-xs);
    border: 1px solid var(--figma-color-border);
    border-radius: var(--figma-radius-md);
    background-color: var(--figma-color-bg);
    color: var(--figma-color-text);
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 20px;
    font-family: var(--figma-font-family);
  }

  .theme-toggle:hover {
    background-color: var(--figma-color-bg-secondary);
    border-color: var(--figma-color-border-strong);
  }

  [data-theme="dark"] .display-color-text2 {
    color: #fff !important;
  }

</style>

<!-- one div for the main UI body of plugin -->
<div id="main" class="main-div">

    <!-- Elements asking about density of confetti -->
    <div>
      <p class="confetti-type-label">Confetti density</p>
      <input type="range" id="slider" class="slider-input" min="30" max="200" value="91">
    </div>

    <div class="select-colors" id="selectColors">
      <p class="confetti-type-label">Select confetti elements</p>
      
      <!-- Elements to select colors -->
      
      <div class="checkboxes">
        <div class="checkbox-div"><input class="checkbox" type="checkbox" id="RecChk" name="RecChk" value="RecChk" checked><label class="checkbox-label" for="RecChk">Rectangles</label></div>
        <div class="blank-div-in-checkboxes"></div>
        <div class="checkbox-div "><input class="checkbox" type="checkbox" id="EllChk" name="EllChk" value="EllChk" checked><label class="checkbox-label" for="EllChk">Ellipses</label></div>
        <div class="checkbox-div "><input class="checkbox" type="checkbox" id="PolyChk" name="PolyChk" value="PolyChk" checked><label class="checkbox-label" for="PolyChk">Polygons</label></div>   
        <div class="blank-div-in-checkboxes"></div>
        <div class="checkbox-div "><input class="checkbox" type="checkbox" id="StarChk" name="StarChk" value="StarChk" checked><label class="checkbox-label" for="StarChk">Stars</label></div>
      </div>

    </div>

    <div class="select-colors" id="selectColors">
      <p class="confetti-type-label">Select colors</p>

      <!-- Elements to select colors -->
      <div class="input-colors-section">
        <div class="color-picker-div">
          <input class="hex-input" type="text" id="hex" name="hex" maxlength="7" value="#FF7272" >
          <input type="color" name="color" id="color" value="#FF7272">
        </div>

        <div class="small-buttons-section">
          <button class="small-button" name="add" id="add"><i class="fas fa-palette"></i>&nbsp;&nbsp;Add color</button>
          <button class="small-button" name="reset" id="reset"><i class="fas fa-sync-alt"></i>&nbsp;&nbsp;Clean palette</button>
        </div>
      
        <div class="display-color-div">
          <p class="display-color-text1" id="display-color1">No colors added</p>
          <p class="display-color-text2" id="display-color2"></p>
        </div>
      </div>

    
      <div class="button-div">
        <button id="generateSelection" class="large-button">Generate with selected colors</button>
      </div>
    </div>

    <!-- Elements to generate with random colors -->

    <div class="random-colors">
      <p class="confetti-type-label">Or</p>
      <button id="generateRandom" class="large-button"><i class="fas fa-random"></i>&nbsp;&nbsp;Generate with random colors</button>
    </div>

  </div>

  <!-- Created a container at bottom to hold two elements at fixed position and at center. Added class in style for handling it -->
  <div class="bottomContainer">
    <div class="leftFooter">
      <button id="themeToggle" class="theme-toggle" title="Switch theme">
        <span id="themeIcon">ðŸŒ™</span>
        <!-- <span id="themeText">Switch to Dark</span> -->
      </button>
    </div>
    <div class="rightFooter">
      <p class="credit"><a href="https://x.com/abhcde" target="_blank">by Abhijit</a></p>
    </div>
  </div>
    
</div>

<script>
  // Theme management
  let currentTheme = 'light';

  // Function to detect theme from Figma
  function detectTheme() {
    // Request theme information from Figma
    if (typeof parent !== "undefined" && parent.postMessage) {
      parent.postMessage({
        pluginMessage: {
          type: "get-theme",
        },
      }, "*");
    } else {
      // Fallback: detect theme from system preference
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      setTheme(prefersDark ? "dark" : "light");
    }
  }

  // Function to set theme
  function setTheme(theme) {
    currentTheme = theme;
    document.documentElement.setAttribute("data-theme", theme);
    
    // Update theme toggle button
    const themeIcon = document.getElementById("themeIcon");
    const themeText = document.getElementById("themeText");
    
    if (theme === "dark") {
      themeIcon.textContent = "â˜€ï¸";
      themeText.textContent = "Switch to Light";
    } else {
      themeIcon.textContent = "ðŸŒ™";
      themeText.textContent = "Switch to Dark";
    }
  }

  // Function to toggle theme
  function toggleTheme() {
    const newTheme = currentTheme === "light" ? "dark" : "light";
    setTheme(newTheme);
  }

  // Listen for theme changes from Figma
  window.addEventListener("message", (event) => {
    if (event.data.pluginMessage?.type === "theme-changed") {
      const figmaTheme = event.data.pluginMessage.theme;
      setTheme(figmaTheme);
    }
  });

  // Listen for system theme changes
  const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
  mediaQuery.addEventListener("change", (e) => {
    const systemTheme = e.matches ? "dark" : "light";
    setTheme(systemTheme);
  });

  // Theme toggle button event listener
  document.getElementById("themeToggle").addEventListener("click", function() {

    toggleTheme();
  });

  // Initial theme detection
  detectTheme();

  // Displaying added colors and pushing these colors to submission array
  var inputColors = [];
  var counter = 1;

  //Getting inputs from color picker, hex input and density slider
  var hexInput = document.getElementById("hex");
  var pickerInput = document.getElementById("color");
  var sliderInput = document.getElementById("slider");

  pickerInput.oninput = function() {
    var pickerValue = `${pickerInput.value}`.toUpperCase();
    hexInput.value = pickerValue;
    pickerValue = `${this.value}`.toUpperCase();
  }

  hexInput.oninput = function() {
    var hexValue = `${hexInput.value}`.toUpperCase();

    if(hexValue[0] !== '#' && hexValue.length > 6){ 
      hexValue = "#"+ hexValue[0] + hexValue[1] + hexValue[2] + hexValue[3] + hexValue[4] + hexValue[5];
    }else if(hexValue[0] !== '#' && hexValue.length === 6){
      hexValue = "#"+ hexValue;
    }else if(hexValue[0] !== '#' && hexValue.length === 1){
      hexValue = "#"+ hexValue[0] + hexValue[0] + hexValue[0] + hexValue[0] + hexValue[0] + hexValue[0];
    }else if(hexValue[0] === '#' && hexValue.length === 2){
      hexValue += hexValue[1] + hexValue[1] + hexValue[1] + hexValue[1] + hexValue[1];
    }else if(hexValue[0] !== '#' && hexValue.length === 2){
      hexValue = "#"+ hexValue[0] + hexValue[1] + hexValue[0] + hexValue[1] + hexValue[0] + hexValue[1];
    }else if(hexValue[0] === '#' && hexValue.length === 3){
      hexValue += hexValue[1] + hexValue[2] + hexValue[1] + hexValue[2];
    }else if(hexValue[0] !== '#' && hexValue.length === 3){
      hexValue = "#"+ hexValue[0] + hexValue[0] + hexValue[1] + hexValue[1] + hexValue[2] + hexValue[2];
    }else if(hexValue[0] === '#' && hexValue.length === 4){
      hexValue = "#"+ hexValue[1] + hexValue[1] + hexValue[2] + hexValue[2] + hexValue[3] + hexValue[3];
    }else if(hexValue[0] !== '#' && hexValue.length === 4){
      hexValue = "#"+ hexValue[0] + hexValue[0] + hexValue[1] + hexValue[1] + hexValue[2] + hexValue[2];
    }else if(hexValue[0] === '#' && hexValue.length === 5){
      hexValue = "#"+ hexValue[1] + hexValue[1] + hexValue[2] + hexValue[2] + hexValue[3] + hexValue[3];
    }else if(hexValue[0] !== '#' && hexValue.length === 5){
      hexValue = "#"+ hexValue[0] + hexValue[0] + hexValue[1] + hexValue[1] + hexValue[2] + hexValue[2];
    }else if(hexValue[0] === '#' && hexValue.length === 6){
      hexValue = "#"+ hexValue[1] + hexValue[1] + hexValue[2] + hexValue[2] + hexValue[3] + hexValue[3];
    }

    pickerInput.value = hexValue;
    hexValue = `${this.value}`.toUpperCase();
  }

  document.getElementById('add').onclick = () => {

    const color = document.getElementById("color");
    const colorValue = `${color.value}`.toUpperCase();
    inputColors.push(colorValue);
    const display1 = document.getElementById("display-color1");
    const display2 = document.getElementById("display-color2");
    const displayDiv = document.getElementById("display-color-div");
    const white = "#FFFFFF";
    const colorValueHtml = "<span style='color:" + colorValue + "'>" + colorValue + "<span><br>";

    if(counter === 1){
      if(display1.innerHTML === "No colors added"){
        display1.innerHTML = "";
        display1.innerHTML += colorValueHtml;
      }else{
        display1.innerHTML += colorValueHtml;
      }
    }else{
        display2.innerHTML += colorValueHtml; 
    }
    counter *= -1;
  };

  document.getElementById('reset').onclick = () => {
    inputColors = [];
    document.getElementById("display-color1").innerHTML = "No colors added";
    document.getElementById("display-color2").innerHTML = "";
    counter = 1;
    hexInput.value = "#FF7272";
    pickerInput.value = "#FF7272";
  };

  //displaying slider input to as label below slider

  //Event function on change in the slider value
  sliderInput.oninput = function (){
    //Define the count value from slider. Var is used in place of const as we want to reassign it to this.value and also access it outside the function in postMessage for drawing confetti
    var count = parseInt(sliderInput.value, 10);
    //call function to display label according to the value
  }

  //Onclick of button, sending a message with content to codeJS
  document.getElementById('generateSelection').onclick = () => {
    const RecValue = RecChk.checked;
    const EllValue = EllChk.checked;
    const PolyValue = PolyChk.checked;
    const StarValue = StarChk.checked;
    var input = parseInt(sliderInput.value, 10);
    parent.postMessage({pluginMessage: { type: 'generate-selection', data: {input, inputColors, RecValue, EllValue, PolyValue, StarValue}}},'*' );
  };

    
  document.getElementById('generateRandom').onclick = () => {
    const RecValue = RecChk.checked;
    const EllValue = EllChk.checked;
    const PolyValue = PolyChk.checked;
    const StarValue = StarChk.checked;
    var input = parseInt(sliderInput.value, 10);
    parent.postMessage({pluginMessage: { type: 'generate-random', data: {input, RecValue, EllValue, PolyValue, StarValue}}},'*' );
  };
</script>